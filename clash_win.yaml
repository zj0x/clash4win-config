# Clash Verge Rev (Mihomo Kernel) Config
# é€‚é… Windows å¹³å° & ä¸­å›½å¤§é™†ç½‘ç»œç¯å¢ƒ
# æ›´æ–°æ—¶é—´ï¼š2026-02

# ---------------------------------------------------
# 1. åŸºç¡€ç›‘å¬ä¸ç«¯å£
# ---------------------------------------------------
mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
ipv6: false
external-controller: 127.0.0.1:9090

# ---------------------------------------------------
# 2. Mihomo æ ¸å¿ƒæ€§èƒ½å‚æ•°
# ---------------------------------------------------
# å¼€å¯ HTTP/3 (QUIC) æ”¯æŒ
prefer-h3: true

# ç»Ÿä¸€å»¶è¿Ÿè®¡ç®—
unified-delay: true

# TCP å¹¶å‘è¿æ¥
tcp-concurrent: true

# ä¿æŒè¿æ¥æ´»è·ƒé—´éš” (ç§’)
keep-alive-interval: 30

# è¿›ç¨‹åŒ¹é…æ¨¡å¼
find-process-mode: strict

# GeoData æ¨¡å¼
geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24

# å¼€å¯ TUN æ¨¡å¼
tun:
  enable: true
  stack: mixed # Recommended for Windows
  dns-hijack:
    - any
  auto-route: true
  auto-detect-interface: true
  mtu: 9000
  strict-route: true           # â† æ–°å¢ï¼šé˜²æ­¢æµé‡æ³„æ¼
  endpoint-independent-nat: true  # â† æ–°å¢ï¼šæ”¹å–„ NAT ç©¿é€ï¼Œæ¸¸æˆè”æœºæ›´ç¨³

# ---------------------------------------------------
# 3. æµé‡å—…æ¢ (Sniffer)
# ---------------------------------------------------
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
    QUIC:
      ports: [443, 8443]
  # ä¸å¯¹ä»¥ä¸‹åŸŸåè¿›è¡Œå—…æ¢
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

# ---------------------------------------------------
# 4. DNS é…ç½®
# ---------------------------------------------------
dns:
  enable: true
  listen: 127.0.0.1:1053
  ipv6: false
  
  # æ¨¡å¼é€‰æ‹©
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  
  # ç¼“å­˜ä¸æ€§èƒ½
  cache-algorithm: arc
  use-hosts: true             # è¯»å–ç³»ç»Ÿ hosts æ–‡ä»¶
  respect-rules: true         # éµå¾ªè§„åˆ™ä¸­çš„ DNS è®¾ç½®
  
  # åŸºç¡€ DNS (ç”¨äºè§£æ DoH åŸŸå)
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  
  # ä»£ç†èŠ‚ç‚¹åŸŸåè§£ææœåŠ¡å™¨
  proxy-server-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  
  # é»˜è®¤ DNS
  nameserver:
  - https://doh.pub/dns-query
  - https://dns.alidns.com/dns-query
  
  # ç­–ç•¥åˆ†æµ DNS
  nameserver-policy:
    # å›½å¤–åŸŸåä½¿ç”¨å›½å¤– DoH
    "geosite:google,youtube,telegram,openai,github,gfw,geolocation-!cn":
      - "https://1.1.1.1/dns-query#h3=true"
      - "https://8.8.8.8/dns-query#h3=true"

    # å›½å†…åŸŸåä½¿ç”¨å›½å†… DNS
    "geosite:cn,geolocation-cn,private,apple,steam@cn,category-games@cn":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query

  # ğŸ”´ Fake-IP è¿‡æ»¤ (Windows ç¨³å®šæ€§æ•‘æ˜Ÿ)
  # ä»¥ä¸‹åŸŸåä¸è¿”å›å‡ IPï¼Œè€Œæ˜¯è¿”å›çœŸå® IPã€‚
  # è§£å†³ Windows ç½‘ç»œæ¢æµ‹æ˜¾ç¤ºâ€œæ— ç½‘ç»œâ€ã€STUN ç©¿é€å¤±è´¥ã€æ¸¸æˆè”æœºå¤±è´¥ç­‰é—®é¢˜
  fake-ip-filter:
    - "+.lan"
    - "+.local"
    - "+.market.xboxcn.com"
    - "+.msftconnecttest.com" # Windows ç½‘ç»œè¿æ¥æ¢æµ‹
    - "+.msftncsi.com"        # Windows ç½‘ç»œè¿æ¥æ¢æµ‹
    - "msftconnecttest.com"
    - "msftncsi.com"
    - "+.battlenet.com.cn"    # æš´é›ªæˆ˜ç½‘å›½æœ
    - "+.stun.*.*"            # STUN ç©¿é€
    - "+.stun.*"
    - "stun.*.*"
    - "stun.*"
    - "+.ntp.org.cn"          # NTP æ—¶é—´åŒæ­¥
    - "+.pool.ntp.org"
    - "localhost.ptlogin2.qq.com"  # QQ ç™»å½•
    - "+.srv.nintendo.net"         # Nintendo
    - "+.stun.playstation.net"     # PlayStation
    - "xbox.*.microsoft.com"       # Xbox
    - "+.xboxlive.com"             # Xbox Live
    - "+.turn.twilio.com"          # Twilio TURN

# ---------------------------------------------------
# 5. ä»£ç†æä¾›è€… (éœ€å¡«å†™æ‚¨çš„è®¢é˜…)
# ---------------------------------------------------
proxy-providers:
  MyAirport:
    type: http
    # ğŸ”´ è¯·åœ¨ä¸‹æ–¹å¼•å·å†…å¡«å…¥ä½ çš„æœºåœºè®¢é˜…é“¾æ¥
    url: "https://example.com/api/v1/client/subscribe?token=YOUR_TOKEN"
    interval: 3600
    path: ./proxies/airport.yaml
    health-check:
      enable: true
      interval: 180
      url: http://cp.cloudflare.com/generate_204
      lazy: true
    filter: "(?i)(HK|TW|JP|SG|US|DE|GB|NL|é¦™æ¸¯|å°æ¹¾|æ—¥æœ¬|æ–°åŠ å¡|ç¾å›½|å¾·å›½|è‹±å›½|è·å…°)"
    override:
      client-fingerprint: chrome
      skip-cert-verify: true
      udp: true

# ---------------------------------------------------
# 6. ç­–ç•¥ç»„
# ---------------------------------------------------
proxy-groups:
  # ä¸»é¢æ¿
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Rocket.png
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "æ‰‹åŠ¨åˆ‡æ¢"
      - "ğŸ¤– AI æœåŠ¡"
      - "ğŸ” Google"
      - "ğŸ“¹ YouTube"
      - "ğŸ“² Telegram"
      - "é¦™æ¸¯ğŸ”˜"
      - "ä¸­å›½å°æ¹¾ğŸ”˜"
      - "æ—¥æœ¬ğŸ”˜"
      - "æ–°åŠ å¡ğŸ”˜"
      - "ç¾å›½ğŸ”˜"
      - "DIRECT"

  # AI æœåŠ¡
  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bot.png
    proxies:
      - "ç¾å›½ğŸ”˜"
      - "æ–°åŠ å¡ğŸ”˜"
      - "æ—¥æœ¬ğŸ”˜"
      - "ä¸­å›½å°æ¹¾ğŸ”˜"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "æ‰‹åŠ¨åˆ‡æ¢"

  # Google æœç´¢
  - name: "ğŸ” Google"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png
    proxies:
      - "ç¾å›½ğŸ”˜"
      - "é¦™æ¸¯ğŸ”˜"
      - "æ–°åŠ å¡ğŸ”˜"
      - "æ—¥æœ¬ğŸ”˜"
      - "æ‰‹åŠ¨åˆ‡æ¢"

  # YouTube
  - name: "ğŸ“¹ YouTube"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "ç¾å›½âš¡"
      - "é¦™æ¸¯âš¡"
      - "æ—¥æœ¬âš¡"
      - "æ–°åŠ å¡âš¡"
      - "æ‰‹åŠ¨åˆ‡æ¢"

  # Telegram
  - name: "ğŸ“² Telegram"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png
    proxies:
      - "æ–°åŠ å¡âš¡"
      - "ç¾å›½âš¡"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "æ‰‹åŠ¨åˆ‡æ¢"

  # å…œåº•
  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "æ‰‹åŠ¨åˆ‡æ¢"
      - "DIRECT"

  # å…¨å±€è‡ªåŠ¨æµ‹é€Ÿ
  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png
    use:
      - MyAirport
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 150

  # æ‰‹åŠ¨åˆ‡æ¢
  - name: "æ‰‹åŠ¨åˆ‡æ¢"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Static.png
    use:
      - MyAirport

  # åœ°åŒºæ‰‹åŠ¨ç»„
  - name: "é¦™æ¸¯ğŸ”˜"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
    use:
      - MyAirport
    filter: "(?i)(HK|Hong Kong|é¦™æ¸¯|HKG)"

  - name: "ä¸­å›½å°æ¹¾ğŸ”˜"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/China.png
    use:
      - MyAirport
    filter: "(?i)(TW|Taiwan|å°æ¹¾|TWN)"

  - name: "æ—¥æœ¬ğŸ”˜"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
    use:
      - MyAirport
    filter: "(?i)(JP|Japan|æ—¥æœ¬|JPN|Tokyo|Osaka)"

  - name: "æ–°åŠ å¡ğŸ”˜"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
    use:
      - MyAirport
    filter: "(?i)(SG|Singapore|æ–°åŠ å¡|SGP)"

  - name: "ç¾å›½ğŸ”˜"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png
    use:
      - MyAirport
    filter: "(?i)(United States|ç¾å›½|USA)"

  # åœ°åŒºè‡ªåŠ¨æµ‹é€Ÿç»„
  - name: "é¦™æ¸¯âš¡"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
    use:
      - MyAirport
    filter: "(?i)(HK|Hong Kong|é¦™æ¸¯|HKG)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 150

  - name: "æ—¥æœ¬âš¡"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
    use:
      - MyAirport
    filter: "(?i)(JP|Japan|æ—¥æœ¬|JPN|Tokyo|Osaka)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 150

  - name: "æ–°åŠ å¡âš¡"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
    use:
      - MyAirport
    filter: "(?i)(SG|Singapore|æ–°åŠ å¡|SGP)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 150

  - name: "ç¾å›½âš¡"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png
    use:
      - MyAirport
    filter: "(?i)(United States|ç¾å›½|USA)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 150

  - name: "æ¬§æ´²âš¡"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/European_Union.png
    use:
      - MyAirport
    filter: "(?i)(DE|Germany|å¾·å›½|GB|UK|United Kingdom|è‹±å›½|NL|Netherlands|è·å…°)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 150

# ---------------------------------------------------
# 7. è§„åˆ™æä¾›è€…
# ---------------------------------------------------
rule-providers:
  sukka_lan:
    type: http
    behavior: classical
    format: text
    url: https://ruleset.skk.moe/Clash/non_ip/lan.txt
    path: ./ruleset/sukka_lan.txt
    interval: 43200
  
  sukka_apple_cn:
    type: http
    behavior: classical
    format: text
    url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt
    path: ./ruleset/sukka_apple_cn.txt
    interval: 43200

  sukka_microsoft_cn:
    type: http
    behavior: classical
    format: text
    url: https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt
    path: ./ruleset/sukka_microsoft_cn.txt
    interval: 43200

  sukka_download:
    type: http
    behavior: domain # çº¯åŸŸååŒ¹é…ï¼Œæ•ˆç‡æé«˜
    format: text
    url: https://ruleset.skk.moe/Clash/domainset/download.txt
    path: ./ruleset/sukka_download.txt
    interval: 43200

  sukka_china_ip:
    type: http
    behavior: ipcidr
    format: text
    url: https://ruleset.skk.moe/Clash/ip/china_ip.txt
    path: ./ruleset/sukka_china_ip.txt
    interval: 43200
  
  Google:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"
    path: ./ruleset/Google.yaml
    interval: 86400

  YouTube:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
    path: ./ruleset/YouTube.yaml
    interval: 86400

  Telegram:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
    path: ./ruleset/Telegram.yaml
    interval: 86400

  GenerativeAI:
    type: http
    behavior: classical
    format: text
    url: "https://raw.githubusercontent.com/EAlyce/conf/refs/heads/main/Rule/OpenAI.list"
    path: ./ruleset/EAlyce_AI.list
    interval: 86400

  Scholar:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Scholar/Scholar.yaml"
    path: ./ruleset/Scholar.yaml
    interval: 86400

  GitHub:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml"
    path: ./ruleset/GitHub.yaml
    interval: 86400
 
  Adobe:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ignaciocastro/a-dove-is-dumb/refs/heads/main/clash.yaml"
    path: ./ruleset/adobe.yaml
    interval: 86400
    
  Microsoft:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml"
    path: ./ruleset/Microsoft.yaml
    interval: 86400

# ---------------------------------------------------
# 8. è§„åˆ™åŒ¹é…
# ---------------------------------------------------
rules:
  # 1. æœ€å…ˆåŒ¹é…ï¼šLAN å’Œç§æœ‰åœ°å€ï¼ˆå‘½ä¸­ç‡æé«˜ï¼‰
  - RULE-SET,sukka_lan,DIRECT
  - GEOIP,PRIVATE,DIRECT,no-resolve
  - GEOSITE,private,DIRECT

  # 2. é«˜é¢‘æ‹¦æˆª
  - RULE-SET,Adobe,REJECT
  #- AND,((NETWORK,UDP),(GEOSITE,youtube)),REJECT

  # 3. å›½å†…ç›´è¿ï¼ˆé«˜é¢‘å‘½ä¸­ï¼‰
  - RULE-SET,sukka_apple_cn,DIRECT
  - RULE-SET,sukka_microsoft_cn,DIRECT
  - RULE-SET,sukka_download,DIRECT
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,category-games@cn,DIRECT

  # 4. ä»£ç†è§„åˆ™ï¼ˆæŒ‰ä½¿ç”¨é¢‘ç‡æ’åˆ—ï¼‰
  - RULE-SET,GenerativeAI,ğŸ¤– AI æœåŠ¡
  - GEOSITE,openai,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,github.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,github.io,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,githubusercontent.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,githubassets.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,ghcr.io,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,github.dev,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,GitHub,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,github,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,Google,ğŸ” Google
  - GEOSITE,google,ğŸ” Google
  - RULE-SET,YouTube,ğŸ“¹ YouTube
  - GEOSITE,youtube,ğŸ“¹ YouTube
  - RULE-SET,Telegram,ğŸ“² Telegram
  - GEOSITE,telegram,ğŸ“² Telegram
  - RULE-SET,Scholar,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,Microsoft,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,gfw,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # 5. å›½å†…å…œåº•ï¼ˆæ”¾åœ¨ä»£ç†è§„åˆ™ä¹‹åï¼Œé¿å…è¯¯ç›´è¿å›½å¤–æµé‡ï¼‰
  - GEOSITE,cn,DIRECT
  - GEOSITE,geolocation-cn,DIRECT
  - RULE-SET,sukka_china_ip,DIRECT,no-resolve
  - GEOIP,CN,DIRECT,no-resolve

  # 6. æœ€ç»ˆå…œåº•
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
