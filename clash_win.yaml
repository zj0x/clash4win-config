# Clash Verge Rev (Mihomo Kernel) Config
# é€‚é… Windows å¹³å° & ä¸­å›½å¤§é™†ç½‘ç»œç¯å¢ƒ
# æ›´æ–°æ—¶é—´ï¼š2026-02

# ---------------------------------------------------
# 1. åŸºç¡€ç›‘å¬ä¸ç«¯å£
# ---------------------------------------------------
port: 7890
socks-port: 7891
mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
ipv6: false
external-controller: 127.0.0.1:9090

# ---------------------------------------------------
# 2. Mihomo æ ¸å¿ƒæ€§èƒ½å‚æ•°
# ---------------------------------------------------
# å¼€å¯ HTTP/3 (QUIC) æ”¯æŒï¼Œå¤§å¹…é™ä½æ¡æ‰‹å»¶è¿Ÿï¼ŒæŠ—ä¸¢åŒ…èƒ½åŠ›å¼º
prefer-h3: true 

# ç»Ÿä¸€å»¶è¿Ÿè®¡ç®—ï¼Œé˜²æ­¢èŠ‚ç‚¹æŠ–åŠ¨
unified-delay: true

# TCP å¹¶å‘è¿æ¥ï¼Œæé«˜æ¡æ‰‹æˆåŠŸç‡
tcp-concurrent: true

# ä¿æŒè¿æ¥æ´»è·ƒé—´éš” (ç§’)ï¼Œé…åˆ HTTP/3 é˜²æ­¢è¿æ¥ä¸­æ–­
keep-alive-interval: 15

# è¿›ç¨‹åŒ¹é…æ¨¡å¼ï¼ŒWindowsä¸‹ strict æ¨¡å¼å¯¹è§„åˆ™åŒ¹é…æ›´ç²¾å‡†
find-process-mode: strict

# GeoData æ¨¡å¼
geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24

# ---------------------------------------------------
# 3. æµé‡å—…æ¢ (Sniffer) - è§£å†³ IP ç›´è¿åº”ç”¨çš„è§„åˆ™åŒ¹é…é—®é¢˜
# ---------------------------------------------------
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
    QUIC:
      ports: [443, 8443]
  # å¼ºåˆ¶ä¸å¯¹ä»¥ä¸‹åŸŸåè¿›è¡Œå—…æ¢ï¼ˆé˜²æ­¢ç±³å“ˆæ¸¸ç­‰æ¸¸æˆæ–­æµï¼‰
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"
# ---------------------------------------------------
# 4. DNS é…ç½® (é€Ÿåº¦ä¼˜åŒ–çš„æ ¸å¿ƒ)
# ---------------------------------------------------
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  
  # æ¨¡å¼é€‰æ‹©
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  
  # ç¼“å­˜ä¸æ€§èƒ½ (Mihomo ä¸“äº«)
  cache-algorithm: arc
  use-hosts: true             # å…è®¸è¯»å–ç³»ç»Ÿ hosts æ–‡ä»¶
  respect-rules: true         # éµå¾ªè§„åˆ™ä¸­çš„ DNS è®¾ç½® (é…åˆ search domain)
  
  # ğŸ”´ å…³é”®ä¼˜åŒ–ï¼šæŒ‡å®šä»£ç†èŠ‚ç‚¹æœ¬èº«åŸŸåçš„è§£ææœåŠ¡å™¨
  # é˜²æ­¢ä»£ç†èŠ‚ç‚¹åŸŸåè¢«æ±¡æŸ“
  proxy-server-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  
  # é»˜è®¤ DNS (ç”¨äºéç­–ç•¥ç»„åŸŸåçš„è§£æå…œåº•)
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    
  # å¤‡ç”¨ DNS (å½“ DoH å¤±è´¥æ—¶å›é€€åˆ° UDPï¼Œä¿è¯æ–­ç½‘æ—¶ä¹Ÿèƒ½æ¢å¤)
  fallback:
    - 223.5.5.5
    - 119.29.29.29
  
  # ğŸ”´ ç­–ç•¥åˆ†æµ (Split DNS) - è¿™é‡Œçš„é¡ºåºå’Œå†™æ³•è‡³å…³é‡è¦
  nameserver-policy:
    # 1. æ‰€æœ‰çš„ Google å’Œ AI æœåŠ¡ï¼Œå¼ºåˆ¶ä½¿ç”¨å›½å¤– DoH (é˜²æ±¡æŸ“ï¼Œä¸”è§£æå‡ºç¦»ä»£ç†æœ€è¿‘çš„ IP)
    "geosite:google,youtube,telegram,openai":
      - "https://1.1.1.1/dns-query#h3=true"
      - "https://8.8.8.8/dns-query#h3=true"
      
    # 2. å›½å¤–å¸¸ç”¨ç«™ç‚¹ï¼Œèµ°å›½å¤– DNS
    "geosite:geolocation-!cn":
      - "https://1.1.1.1/dns-query#h3=true"
      - "https://8.8.8.8/dns-query#h3=true"

    # 3. å›½å†…åŸŸåï¼Œå¼ºåˆ¶èµ°å›½å†… DNS (è…¾è®¯+é˜¿é‡Œ)
    "geosite:cn,private,apple,steam@cn":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query

  # ğŸ”´ Fake-IP è¿‡æ»¤ (Windows ç¨³å®šæ€§æ•‘æ˜Ÿ)
  # ä»¥ä¸‹åŸŸåä¸è¿”å›å‡ IPï¼Œè€Œæ˜¯è¿”å›çœŸå® IPã€‚
  # è§£å†³ Windows ç½‘ç»œæ¢æµ‹æ˜¾ç¤ºâ€œæ— ç½‘ç»œâ€ã€STUN ç©¿é€å¤±è´¥ã€æ¸¸æˆè”æœºå¤±è´¥ç­‰é—®é¢˜
  fake-ip-filter:
    - "*"  # å¦‚æœä½ å‘ç°æŸäº›å±€åŸŸç½‘è®¾å¤‡æ— æ³•è¿æ¥ï¼Œå¯ä»¥ä¿ç•™è¿™ä¸ªé€šé…ç¬¦ï¼Œä½†é€šå¸¸ä¸å»ºè®®
    - "+.lan"
    - "+.local"
    - "+.market.xboxcn.com"
    - "+.msftconnecttest.com" # Windows ç½‘ç»œè¿æ¥æ¢æµ‹
    - "+.msftncsi.com"        # Windows ç½‘ç»œè¿æ¥æ¢æµ‹
    - "msftconnecttest.com"
    - "msftncsi.com"
    - "+.battlenet.com.cn"    # æš´é›ªæˆ˜ç½‘å›½æœ
    - "+.stun.*.*"            # STUN ç©¿é€
    - "+.stun.*"
    - "stun.*.*"
    - "stun.*"
    - "+.ntp.org.cn"          # NTP æ—¶é—´åŒæ­¥
    - "+.pool.ntp.org"

# ---------------------------------------------------
# 5. ä»£ç†æä¾›è€… (éœ€å¡«å†™æ‚¨çš„è®¢é˜…)
# ---------------------------------------------------
proxy-providers:
  MyAirport:
    type: http
    # ğŸ”´ğŸ”´ğŸ”´ è¯·åœ¨ä¸‹æ–¹å¼•å·å†…å¡«å…¥ä½ çš„æœºåœºè®¢é˜…é“¾æ¥ ğŸ”´ğŸ”´ğŸ”´
    url: "https://example.com/api/v1/client/subscribe?token=YOUR_TOKEN"
    interval: 3600
    path: ./proxies/airport.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
    # æ’é™¤å€ç‡è¿‡é«˜æˆ–æ— æ•ˆèŠ‚ç‚¹
    filter: "(?i)(HK|TW|JP|SG|US|DE|GB|NL|é¦™æ¸¯|å°æ¹¾|æ—¥æœ¬|æ–°åŠ å¡|ç¾å›½|å¾·å›½|è‹±å›½|è·å…°)"

# ---------------------------------------------------
# 6. ç­–ç•¥ç»„ (ä¿æŒåŸæœ‰é€»è¾‘ï¼Œå¢åŠ å®¹é”™)
# ---------------------------------------------------
proxy-groups:
  # 1. ä¸»é¢æ¿ (å…¥å£)
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Rocket.png
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "ğŸ¤– AI æœåŠ¡"
      - "ğŸ” Google"
      - "ğŸ“¹ YouTube"
      - "ğŸ“² Telegram"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯æ‰‹åŠ¨"
      - "ğŸ‡¹ğŸ‡¼ å°æ¹¾æ‰‹åŠ¨"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ‰‹åŠ¨"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ‰‹åŠ¨"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½æ‰‹åŠ¨"
      - "DIRECT"

  # 2. AI æœåŠ¡
  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bot.png
    proxies:
      - "ğŸ‡ºğŸ‡¸ ç¾å›½æ‰‹åŠ¨"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ‰‹åŠ¨"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ‰‹åŠ¨"
      - "ğŸ‡¹ğŸ‡¼ å°æ¹¾æ‰‹åŠ¨"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"

  # 3. Google æœç´¢ 
  - name: "ğŸ” Google"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png
    proxies:
      - "ğŸ‡ºğŸ‡¸ ç¾å›½æ‰‹åŠ¨"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯æ‰‹åŠ¨"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ‰‹åŠ¨"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ‰‹åŠ¨"

  # 4. YouTube 
  - name: "ğŸ“¹ YouTube"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯è‡ªåŠ¨"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬è‡ªåŠ¨"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨"

  # 5. Telegram
  - name: "ğŸ“² Telegram"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png
    proxies:
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"

  # 6. å…œåº•
  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Fish.png
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "DIRECT"

  # 7. å…¨å±€è‡ªåŠ¨æµ‹é€Ÿ
  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png
    use:
      - MyAirport
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

  # ============================================
  # åœ°åŒºåˆ†ç»„ï¼šæ‰‹åŠ¨ç»„ (Select)
  # ============================================
  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯æ‰‹åŠ¨"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
    use:
      - MyAirport
    filter: "(?i)(HK|Hong Kong|é¦™æ¸¯|HKG)"

  - name: "ğŸ‡¹ğŸ‡¼ å°æ¹¾æ‰‹åŠ¨"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png
    use:
      - MyAirport
    filter: "(?i)(TW|Taiwan|å°æ¹¾|TWN)"

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ‰‹åŠ¨"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
    use:
      - MyAirport
    filter: "(?i)(JP|Japan|æ—¥æœ¬|JPN|Tokyo|Osaka)"

  - name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ‰‹åŠ¨"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
    use:
      - MyAirport
    filter: "(?i)(SG|Singapore|æ–°åŠ å¡|SGP)"

  - name: "ğŸ‡ºğŸ‡¸ ç¾å›½æ‰‹åŠ¨"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png
    use:
      - MyAirport
    filter: "(?i)(US|United States|ç¾å›½|USA)"

  # ============================================
  # åœ°åŒºåˆ†ç»„ï¼šè‡ªåŠ¨æµ‹é€Ÿç»„ (Url-Test)
  # ============================================
  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯è‡ªåŠ¨"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
    use:
      - MyAirport
    filter: "(?i)(HK|Hong Kong|é¦™æ¸¯|HKG)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬è‡ªåŠ¨"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
    use:
      - MyAirport
    filter: "(?i)(JP|Japan|æ—¥æœ¬|JPN|Tokyo|Osaka)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

  - name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
    use:
      - MyAirport
    filter: "(?i)(SG|Singapore|æ–°åŠ å¡|SGP)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

  - name: "ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png
    use:
      - MyAirport
    filter: "(?i)(US|United States|ç¾å›½|USA)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50
    
  - name: "ğŸ‡ªğŸ‡º æ¬§æ´²è‡ªåŠ¨"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/European_Union.png
    use:
      - MyAirport
    filter: "(?i)(DE|Germany|å¾·å›½|GB|UK|United Kingdom|è‹±å›½|NL|Netherlands|è·å…°)"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

# ---------------------------------------------------
# 7. è§„åˆ™æä¾›è€…
# ---------------------------------------------------
rule-providers:
  Google:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"
    path: ./ruleset/Google.yaml
    interval: 86400

  YouTube:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
    path: ./ruleset/YouTube.yaml
    interval: 86400

  Telegram:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
    path: ./ruleset/Telegram.yaml
    interval: 86400

  GenerativeAI:
    type: http
    behavior: classical
    format: text 
    url: "https://raw.githubusercontent.com/EAlyce/conf/refs/heads/main/Rule/OpenAI.list"
    path: ./ruleset/EAlyce_AI.list
    interval: 86400

  Microsoft:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml"
    path: ./ruleset/Microsoft.yaml
    interval: 86400

# ---------------------------------------------------
# 7. è§„åˆ™åŒ¹é…
# ---------------------------------------------------
rules:
  # 1. AI æœåŠ¡ (Gemini, Claude, OpenAI, Copilot, Grok ç­‰å…¨è¦†ç›–)
  - RULE-SET,GenerativeAI,ğŸ¤– AI æœåŠ¡
  
  # 2. å¸¸ç”¨æœåŠ¡
  - RULE-SET,YouTube,ğŸ“¹ YouTube
  - RULE-SET,Telegram,ğŸ“² Telegram
  - RULE-SET,Google,ğŸ” Google  # Google ç°åœ¨èµ°å•ç‹¬çš„æ‰‹åŠ¨ç»„
  
  # 3. å¾®è½¯æœåŠ¡ (GitHub/Copilot ç›¸å…³)
  - RULE-SET,Microsoft,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  
  # 4. GeoSite è¡¥å……
  - GEOSITE,google,ğŸ” Google
  - GEOSITE,youtube,ğŸ“¹ YouTube
  - GEOSITE,telegram,ğŸ“² Telegram
  - GEOSITE,github,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,openai,ğŸ¤– AI æœåŠ¡

  # 5. ç›´è¿è§„åˆ™
  - GEOSITE,cn,DIRECT
  - GEOIP,CN,DIRECT
  - GEOIP,PRIVATE,DIRECT
  
  # 6. å…œåº•
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
